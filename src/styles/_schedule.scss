@use 'variables' as *;
@use 'mixins' as *;

/**
 * Main schedule grid layout - left headers + right content
 */
 .weekly-schedule {
  --header-height: $day-header-height;
  --cross-axis-width: $time-axis-width;
  display: flex;
  flex-direction: column;
  background: var(--schedule-bg-color, $color-bg);
  border: 1px solid var(--schedule-grid-line-color, $color-border);
  border-radius: 8px;
  overflow: hidden;
  font-family: var(--schedule-font-family, $font-family);
  min-width: 0;
 }

 .schedule-top {
  display: grid;
  grid-template-columns: var(--cross-axis-width) 1fr;
  height: var(--header-height);
  min-width: 0;
 }
/* Ensure header height is consistent in vertical zoom and non-zoom */
.weekly-schedule.vertical .schedule-top { height: var(--header-height); }
.weekly-schedule.zoomed.vertical .schedule-top { height: var(--header-height); }
.weekly-schedule.vertical .schedule-top .axis-horizontal { height: var(--header-height); }
.weekly-schedule.zoomed.vertical .schedule-top .axis-horizontal { height: var(--header-height); }

 .schedule-top-spacer {
  background: var(--schedule-bg-color, $color-bg-alt);
  border-bottom: 1px solid var(--schedule-grid-line-color, $color-border);
 }

.schedule-main { display: none; }
 .schedule-scroll {
  flex: 1 1 auto;
  min-height: 0;
  width: 100%;
  height: 100%;
  overflow: hidden; // overridden per orientation
  display: grid;
 }


.weekly-schedule.horizontal .schedule-main {
  display: grid;
  grid-template-columns: var(--cross-axis-width) 1fr;
}

.weekly-schedule.horizontal .schedule-main > .axis-vertical {
  grid-column: 1;
  grid-row: 1;
  height: 100%;
}

.weekly-schedule.horizontal .schedule-main > .schedule-scroll {
  grid-column: 2;
  grid-row: 1;
}

.weekly-schedule.horizontal .schedule-scroll {
  position: relative;
  grid-template-rows: var(--header-height) 1fr;
  grid-template-columns: 1fr;
  overflow-x: auto;
  overflow-y: hidden;
}

.weekly-schedule.horizontal .schedule-scroll .axis-horizontal {
  grid-row: 1;
  grid-column: 1;
}

.weekly-schedule.horizontal .schedule-scroll .events-grid {
  grid-row: 2;
  grid-column: 1;
}

.weekly-schedule.vertical .schedule-main {
  display: block;
  height: 100%;
}

.weekly-schedule.vertical .schedule-scroll {
  grid-template-columns: var(--cross-axis-width) 1fr;
  grid-template-rows: 1fr;
  overflow-y: auto;
  overflow-x: hidden;
}

.weekly-schedule.vertical .schedule-scroll .axis-vertical {
  grid-column: 1;
  grid-row: 1;
}

.weekly-schedule.vertical .schedule-scroll .events-grid {
  grid-column: 2;
  grid-row: 1;
}


/**
 * Intersection cell (top-left corner)
 */
 .schedule-intersection {
  background: var(--schedule-bg-color, $color-bg-header);
  border-right: 1px solid var(--schedule-grid-line-color, $color-border);
  border-bottom: 1px solid var(--schedule-grid-line-color, $color-border);
  display: flex;
  align-items: center;
  gap: $spacing-sm;
  padding: 0 $spacing-sm;
 }

 .zoom-reset-btn {
  appearance: none;
  border: none;
  background: transparent;
  color: var(--schedule-header-text-color, $color-text-primary);
  font-weight: $font-weight-medium;
  cursor: pointer;
 }




/**
 * Flex container for axes
 * Base styles for both horizontal and vertical axes
 */
 .axis-horizontal,
 .axis-vertical {
   background: var(--schedule-bg-color, $color-bg-alt);
 }

 .axis-horizontal {
   border-bottom: 1px solid var(--schedule-grid-line-color, $color-border);
 }

 .axis-vertical {
   border-right: 1px solid var(--schedule-grid-line-color, $color-border);
 }


 /**
  * Horizontal axis (day headers or time labels)
  * Always a flex row
  */
  .axis-horizontal {
    display: flex;
    flex-direction: row;
    min-width: 0;
  }
  .axis-horizontal > * { flex: 1 1 0; }

  // Fixed hour width in zoomed horizontal mode
  .weekly-schedule.zoomed.horizontal .axis-horizontal > * {
    flex: 0 0 var(--hour-col-width, 160px);
  }
  .weekly-schedule.zoomed.horizontal .axis-horizontal { width: max-content; }

 // Fixed hour width in zoomed horizontal mode
 .weekly-schedule.zoomed.horizontal .axis-horizontal {
   grid-template-columns: repeat(var(--num-columns, 8), var(--hour-col-width, 160px));
   width: max-content;
 }



/**
 * Vertical axis (time labels)
 */
 .axis-vertical {
  display: flex;
  flex-direction: column;
  min-height: 0; // Allow flex to shrink
  height: 100%; // Span full component height
  
  // Equal growth for children
  > * {
    flex: 1 1 0;
    min-height: 0; // Allow shrinking
  }
 }

 // Fixed slot height in zoomed vertical mode (scrolls)
 /* Keep row height consistent between zoomed and unzoomed in vertical mode */
 .weekly-schedule.zoomed.vertical .axis-vertical {
  height: 100%;
 }
 .weekly-schedule.zoomed.vertical .axis-vertical > * {
  flex: 1 1 0;
  min-height: 0;
 }

/**
 * Time label
 */
 .time-label {
  display: inline-block;
  font-size: $font-size-sm;
  color: var(--schedule-time-text-color, $color-text-secondary);
  background: var(--schedule-bg-color, $color-bg-alt);
  padding: 0 $spacing-xs;
  pointer-events: none; // labels are informational
 }

  /* Left-aligned time labels; border-left renders tick */
 .weekly-schedule.horizontal .axis-horizontal {
  display: flex;
  flex-direction: row;
  min-width: 0;
 }
 .weekly-schedule.horizontal .axis-horizontal > .time-label {
  flex: 1 1 0;
  display: flex;
  align-items: center;
  justify-content: flex-start;
  padding-left: $spacing-sm;
  //border-left: 1px solid var(--schedule-grid-line-color, $color-border);
 }
 .weekly-schedule.zoomed.horizontal .axis-horizontal > .time-label {
  flex: 0 0 var(--hour-col-width, 160px);
 }

 .weekly-schedule.vertical .axis-vertical {
  display: grid;
  grid-auto-flow: row;
  grid-auto-rows: 1fr;
 }
 .weekly-schedule.vertical .axis-vertical .time-label {
  align-self: flex-start;
 }
 /* Maintain same row sizing when zoomed */
 .weekly-schedule.zoomed.vertical .axis-vertical {
  grid-template-rows: repeat(var(--num-rows), 1fr);
 }


/**
 * Day header
 */
 .day-header {
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: $font-weight-semibold;
  font-size: $font-size-sm;
  color: var(--schedule-header-text-color, $color-text-primary);
  background: var(--schedule-bg-color, $color-bg-header);
  padding: $spacing-sm $spacing-md;
  flex: 1;
  cursor: pointer;
  
  // Horizontal orientation: headers are in vertical axis
  .axis-vertical & {
    height: $day-header-height; // Match header height
  }
 }

  .weekly-schedule.zoomed .day-header.selected {
   background: rgba($color-primary, 0.15);
  }

  /* Zoom hint CTA in intersection cell */
  .zoom-hint {
    display: flex;
    align-items: center;
    gap: 4px;
    font-size: $font-size-xs;
    color: $color-text-secondary;
    line-height: 1.2;
  }
  .zoom-hint-icon { opacity: 0.7; }

  /* Overlay zoom affordance using pseudo-elements */
  .day-header { position: relative; }
  .day-header .day-header-label { transition: opacity .12s ease; }

  /* Fade out label when overlay is shown */
  .weekly-schedule:not(.zoomed) .day-header:hover .day-header-label,
  .weekly-schedule:not(.zoomed) .day-header:focus-visible .day-header-label,
  .weekly-schedule.zoomed .day-header:not(.selected):hover .day-header-label,
  .weekly-schedule.zoomed .day-header:not(.selected):focus-visible .day-header-label,
  .weekly-schedule.zoomed .day-header.selected:hover .day-header-label,
  .weekly-schedule.zoomed .day-header.selected:focus-visible .day-header-label {
    opacity: 0;
    color: transparent;
    visibility: hidden;
  }

  /* Inline icon overlay span centered; replaces ::after content */
  .day-header .day-header-icon {
    position: absolute;
    inset: 0;
    display: none;
    align-items: center;
    justify-content: center;
    font-size: 1.1em;
    color: #fff;
    opacity: 0;
    pointer-events: none;
    transition: opacity .15s ease;
    border-radius: inherit;
  }
  /* Backgrounds for overlay */
  .weekly-schedule:not(.zoomed) .day-header .day-header-icon,
  .weekly-schedule.zoomed .day-header:not(.selected) .day-header-icon {
    background: rgba(0,0,0,0.45);
  }
  .weekly-schedule.zoomed .day-header.selected .day-header-icon {
    background: rgba($color-primary, 1);
  }
  /* Show overlay on hover/focus */
  .weekly-schedule:not(.zoomed) .day-header:hover .day-header-icon,
  .weekly-schedule:not(.zoomed) .day-header:focus-visible .day-header-icon,
  .weekly-schedule.zoomed .day-header:not(.selected):hover .day-header-icon,
  .weekly-schedule.zoomed .day-header:not(.selected):focus-visible .day-header-icon,
  .weekly-schedule.zoomed .day-header.selected:hover .day-header-icon,
  .weekly-schedule.zoomed .day-header.selected:focus-visible .day-header-icon {
    display: flex;
    opacity: 1;
  }


/**
 * Events grid - nested grid containing only events
 */
 .events-grid {
   --line-thickness: 1px;
   display: grid;
   grid-template-columns: repeat(var(--num-columns, 5), 1fr);
   grid-template-rows: repeat(var(--num-rows, 8), minmax(0, 1fr));
   position: relative;
   min-height: 0;
   width: 100%;
   height: 100%;
   overflow: hidden; // events themselves are absolutely positioned
 }

 // Grid lines moved to scroll container children (optional). Keep existing if needed.
 .events-grid::after,
 .events-grid::before {
   content: none;
 }

 // Normal mode: fluid sizing

/* Horizontal: left fixed column for intersection + day headers; right scroll contains time axis + events */
.weekly-schedule.horizontal {
  display: grid;
  grid-template-columns: var(--cross-axis-width) 1fr;
  grid-template-rows: 1fr;
  height: 100%;
  min-height: 0;
}
.weekly-schedule.horizontal .schedule-left {
  grid-column: 1;
  grid-row: 1;
  display: grid;
  grid-template-rows: var(--header-height) 1fr;
  height: 100%;
  min-height: 0;
}
.weekly-schedule.horizontal .schedule-left .schedule-intersection {
  border-right: 1px solid var(--schedule-grid-line-color, $color-border);
  border-bottom: 1px solid var(--schedule-grid-line-color, $color-border);
}
.weekly-schedule.horizontal .schedule-left .axis-vertical {
  border-right: 1px solid var(--schedule-grid-line-color, $color-border);
  grid-row: 2;
  height: 100%;
}
.weekly-schedule.horizontal .schedule-scroll {
  grid-column: 2;
  grid-row: 1;
  display: grid;
  grid-template-rows: var(--header-height) 1fr;
  overflow-x: auto;
  overflow-y: hidden;
  height: 100%;
  min-height: 0;
}
 .weekly-schedule.horizontal .schedule-scroll .axis-horizontal {
   grid-row: 1;
   grid-column: 1;
  height: var(--header-height);
  min-height: 0;
 }
 .weekly-schedule.horizontal .schedule-scroll .events-grid {
   position: relative;
   grid-row: 2;
   grid-column: 1;
  height: 100%;
  min-height: 0;
 }

 /* Horizontal orientation: add horizontal day separator lines (not in zoomed mode since only one day visible) */
 .weekly-schedule.horizontal:not(.zoomed) .events-grid::after {
   @include grid-line-pseudo;
   background-repeat: no-repeat;
   background-size: 100% 100%;
   background-image: repeating-linear-gradient(
     to bottom,
     transparent 0,
     transparent calc((100% / var(--num-rows)) - var(--line-thickness, 1px)),
     var(--schedule-grid-line-color, $color-border) calc((100% / var(--num-rows)) - var(--line-thickness, 1px)),
     var(--schedule-grid-line-color, $color-border) calc(100% / var(--num-rows))
   );
 }

 /* Horizontal orientation: add vertical tick marks on time slot boundaries */
 .weekly-schedule.horizontal:not(.zoomed) .schedule-scroll::before {
   @include grid-line-pseudo;
   background-repeat: no-repeat;
   background-size: 100% 100%;
   background-image: repeating-linear-gradient(
     to right,
     transparent 0,
     transparent calc((100% / var(--num-columns)) - var(--line-thickness, 1px)),
     var(--schedule-grid-line-color, $color-border) calc((100% / var(--num-columns)) - var(--line-thickness, 1px)),
     var(--schedule-grid-line-color, $color-border) calc(100% / var(--num-columns))
   );
 }
 /* Vertical orientation horizontal lines */
  .weekly-schedule.vertical .axis-vertical,
  .weekly-schedule.vertical .events-grid { position: relative; }
  .weekly-schedule.vertical .axis-vertical,
  .weekly-schedule.vertical .events-grid { position: relative; }
  /* Horizontal slot lines */
  .weekly-schedule.vertical .axis-vertical::before,
  .weekly-schedule.vertical .events-grid::before {
    @include grid-line-pseudo;
    background-repeat: no-repeat;
    background-size: 100% 100%;
    background-image: repeating-linear-gradient(
      to bottom,
      transparent 0,
      transparent calc((100% / var(--num-rows)) - var(--line-thickness, 1px)),
      var(--schedule-grid-line-color, $color-border) calc((100% / var(--num-rows)) - var(--line-thickness, 1px)),
      var(--schedule-grid-line-color, $color-border) calc(100% / var(--num-rows))
    );
  }
  /* Ensure events-grid is a positioning context in vertical mode */
  .weekly-schedule.vertical .events-grid { position: relative; }

  /* Vertical day separators only on events grid for precise alignment */
  .weekly-schedule.vertical .events-grid::after {
    @include grid-line-pseudo;
    background-repeat: no-repeat;
    background-size: 100% 100%;
    background-image: repeating-linear-gradient(
      to right,
      transparent 0,
      transparent calc((100% / var(--num-columns)) - var(--line-thickness, 1px)),
      var(--schedule-grid-line-color, $color-border) calc((100% / var(--num-columns)) - var(--line-thickness, 1px)),
      var(--schedule-grid-line-color, $color-border) calc(100% / var(--num-columns))
    );
  }

 /* GRID LINES - ZOOMED MODE (FIXED SIZES) */
  .weekly-schedule.zoomed.horizontal .schedule-scroll::before {
    @include grid-line-pseudo;
    width: calc(var(--num-columns, 8) * var(--hour-col-width, 160px));
    height: 100%;
    background-image: repeating-linear-gradient(
      to right,
      transparent 0,
      transparent calc(var(--hour-col-width, 160px) - var(--line-thickness, 1px)),
      var(--schedule-grid-line-color, $color-border) calc(var(--hour-col-width, 160px) - var(--line-thickness, 1px)),
      var(--schedule-grid-line-color, $color-border) var(--hour-col-width, 160px)
    );
  }
  .weekly-schedule.zoomed.vertical .axis-vertical::before,
  .weekly-schedule.zoomed.vertical .events-grid::before {
    background-image: repeating-linear-gradient(
      to bottom,
      transparent 0,
      transparent calc((100% / var(--num-rows)) - var(--line-thickness, 1px)),
      var(--schedule-grid-line-color, $color-border) calc((100% / var(--num-rows)) - var(--line-thickness, 1px)),
      var(--schedule-grid-line-color, $color-border) calc(100% / var(--num-rows))
    );
  }




